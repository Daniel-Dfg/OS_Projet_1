#!/bin/bash

# argv
pseudo_recipient=$1
pseudo_bot=$2
if [[ -z $pseudo_bot ]]; then
    pseudo_bot="bot"
fi

#conditions
function error_handling(){
    if [[ -z $pseudo_recipient ]]; then # TODO selon les consignes faire pour un number incorrect de parametre donc plus que 2 aussi?
        echo "chat-bot destinataire [pseudo]"
        exit 1
    fi
}

# input loop
function bot_loop(){
    while true;
    do
        read -p "Entre command: " command
        commands_responses $command
    done
}

# responses
function commands_responses(){
    if [ "$*" == "liste" ]; then
        ls
    elif [ $1 == "li" ]; then
        if [ -f $2 ]; then
            cat $2
        else
            echo "WARNING: File dosn't exist"
        fi
    elif [ "$*" == "qui suis-je" ]; then
        echo $pseudo_recipient
    elif [ "$*" == "au revoir" ]; then
        exit 0
    else
        check_liste_bot $1
    fi
}

# checking liste_bot.txt
function check_liste_bot(){
    not_found=true
    while read -r line; do
        first_word=$(echo "$line" | awk '{print$1}')
        if [ $first_word == $1 ]; then
            echo $line
            not_found=false
        fi
    done <liste-bot.txt

    if $not_found ; then
        echo "ðŸ¤– ?"
    fi
}

# main function
function main(){
    error_handling
    bot_loop
}
main
